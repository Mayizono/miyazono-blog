{
    "version": "https://jsonfeed.org/version/1",
    "title": "冬樱茶",
    "subtitle": "",
    "icon": "https://github.com/Mayizono/miyazono.github.io/images/favicon.ico",
    "description": "",
    "home_page_url": "https://github.com/Mayizono/miyazono.github.io",
    "items": [
        {
            "id": "https://github.com/Mayizono/miyazono.github.io/big-data/zookeeper/hello-world/",
            "url": "https://github.com/Mayizono/miyazono.github.io/big-data/zookeeper/hello-world/",
            "title": "Hello World",
            "date_published": "2021-08-21T16:32:34.087Z",
            "content_html": "<p>Welcome to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo</span>! This is your very first post. Check <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv\">documentation</span> for more info. If you get any problems when using Hexo, you can find the answer in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=\">troubleshooting</span> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"quick-start\"><a class=\"anchor\" href=\"#quick-start\">#</a> Quick Start</h2>\n<h3 id=\"create-a-new-post\"><a class=\"anchor\" href=\"#create-a-new-post\">#</a> Create a new post</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo new <span class=\"token string\">\"My New Post\"</span></pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s\">Writing</span></p>\n<h3 id=\"run-server\"><a class=\"anchor\" href=\"#run-server\">#</a> Run server</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo server</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=\">Server</span></p>\n<h3 id=\"generate-static-files\"><a class=\"anchor\" href=\"#generate-static-files\">#</a> Generate static files</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo generate</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s\">Generating</span></p>\n<h3 id=\"deploy-to-remote-sites\"><a class=\"anchor\" href=\"#deploy-to-remote-sites\">#</a> Deploy to remote sites</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo deploy</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvb25lLWNvbW1hbmQtZGVwbG95bWVudC5odG1s\">Deployment</span></p>\n",
            "tags": [
                "大数据",
                "Zookeeper"
            ]
        },
        {
            "id": "https://github.com/Mayizono/miyazono.github.io/big-data/kafka/hello-world/",
            "url": "https://github.com/Mayizono/miyazono.github.io/big-data/kafka/hello-world/",
            "title": "Hello World",
            "date_published": "2021-08-21T16:31:13.779Z",
            "content_html": "<p>Welcome to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo</span>! This is your very first post. Check <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv\">documentation</span> for more info. If you get any problems when using Hexo, you can find the answer in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=\">troubleshooting</span> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"quick-start\"><a class=\"anchor\" href=\"#quick-start\">#</a> Quick Start</h2>\n<h3 id=\"create-a-new-post\"><a class=\"anchor\" href=\"#create-a-new-post\">#</a> Create a new post</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo new <span class=\"token string\">\"My New Post\"</span></pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s\">Writing</span></p>\n<h3 id=\"run-server\"><a class=\"anchor\" href=\"#run-server\">#</a> Run server</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo server</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=\">Server</span></p>\n<h3 id=\"generate-static-files\"><a class=\"anchor\" href=\"#generate-static-files\">#</a> Generate static files</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo generate</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s\">Generating</span></p>\n<h3 id=\"deploy-to-remote-sites\"><a class=\"anchor\" href=\"#deploy-to-remote-sites\">#</a> Deploy to remote sites</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo deploy</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvb25lLWNvbW1hbmQtZGVwbG95bWVudC5odG1s\">Deployment</span></p>\n",
            "tags": [
                "大数据",
                "Kafka"
            ]
        },
        {
            "id": "https://github.com/Mayizono/miyazono.github.io/big-data/hadoop/hello-world/",
            "url": "https://github.com/Mayizono/miyazono.github.io/big-data/hadoop/hello-world/",
            "title": "Hello World",
            "date_published": "2021-08-21T16:31:11.456Z",
            "content_html": "<p>Welcome to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo</span>! This is your very first post. Check <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv\">documentation</span> for more info. If you get any problems when using Hexo, you can find the answer in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=\">troubleshooting</span> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"quick-start\"><a class=\"anchor\" href=\"#quick-start\">#</a> Quick Start</h2>\n<h3 id=\"create-a-new-post\"><a class=\"anchor\" href=\"#create-a-new-post\">#</a> Create a new post</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo new <span class=\"token string\">\"My New Post\"</span></pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s\">Writing</span></p>\n<h3 id=\"run-server\"><a class=\"anchor\" href=\"#run-server\">#</a> Run server</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo server</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=\">Server</span></p>\n<h3 id=\"generate-static-files\"><a class=\"anchor\" href=\"#generate-static-files\">#</a> Generate static files</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo generate</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s\">Generating</span></p>\n<h3 id=\"deploy-to-remote-sites\"><a class=\"anchor\" href=\"#deploy-to-remote-sites\">#</a> Deploy to remote sites</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo deploy</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvb25lLWNvbW1hbmQtZGVwbG95bWVudC5odG1s\">Deployment</span></p>\n",
            "tags": [
                "大数据",
                "Hadoop"
            ]
        },
        {
            "id": "https://github.com/Mayizono/miyazono.github.io/big-data/flink/hello-world/",
            "url": "https://github.com/Mayizono/miyazono.github.io/big-data/flink/hello-world/",
            "title": "Hello World",
            "date_published": "2021-08-21T16:12:43.574Z",
            "content_html": "<p>Welcome to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo</span>! This is your very first post. Check <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv\">documentation</span> for more info. If you get any problems when using Hexo, you can find the answer in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=\">troubleshooting</span> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"quick-start\"><a class=\"anchor\" href=\"#quick-start\">#</a> Quick Start</h2>\n<h3 id=\"create-a-new-post\"><a class=\"anchor\" href=\"#create-a-new-post\">#</a> Create a new post</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo new <span class=\"token string\">\"My New Post\"</span></pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s\">Writing</span></p>\n<h3 id=\"run-server\"><a class=\"anchor\" href=\"#run-server\">#</a> Run server</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo server</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=\">Server</span></p>\n<h3 id=\"generate-static-files\"><a class=\"anchor\" href=\"#generate-static-files\">#</a> Generate static files</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo generate</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s\">Generating</span></p>\n<h3 id=\"deploy-to-remote-sites\"><a class=\"anchor\" href=\"#deploy-to-remote-sites\">#</a> Deploy to remote sites</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo deploy</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvb25lLWNvbW1hbmQtZGVwbG95bWVudC5odG1s\">Deployment</span></p>\n",
            "tags": [
                "大数据",
                "Flink"
            ]
        },
        {
            "id": "https://github.com/Mayizono/miyazono.github.io/big-data/spark/hello-world/",
            "url": "https://github.com/Mayizono/miyazono.github.io/big-data/spark/hello-world/",
            "title": "Hello World",
            "date_published": "2021-08-21T16:12:43.359Z",
            "content_html": "<p>Welcome to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo</span>! This is your very first post. Check <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv\">documentation</span> for more info. If you get any problems when using Hexo, you can find the answer in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=\">troubleshooting</span> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"quick-start\"><a class=\"anchor\" href=\"#quick-start\">#</a> Quick Start</h2>\n<h3 id=\"create-a-new-post\"><a class=\"anchor\" href=\"#create-a-new-post\">#</a> Create a new post</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo new <span class=\"token string\">\"My New Post\"</span></pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s\">Writing</span></p>\n<h3 id=\"run-server\"><a class=\"anchor\" href=\"#run-server\">#</a> Run server</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo server</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=\">Server</span></p>\n<h3 id=\"generate-static-files\"><a class=\"anchor\" href=\"#generate-static-files\">#</a> Generate static files</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo generate</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s\">Generating</span></p>\n<h3 id=\"deploy-to-remote-sites\"><a class=\"anchor\" href=\"#deploy-to-remote-sites\">#</a> Deploy to remote sites</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ hexo deploy</pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvb25lLWNvbW1hbmQtZGVwbG95bWVudC5odG1s\">Deployment</span></p>\n",
            "tags": [
                "大数据",
                "Spark"
            ]
        },
        {
            "id": "https://github.com/Mayizono/miyazono.github.io/Day10-%E7%BB%A7%E6%89%BF/",
            "url": "https://github.com/Mayizono/miyazono.github.io/Day10-%E7%BB%A7%E6%89%BF/",
            "title": "Java基础--继承",
            "date_published": "2021-08-17T13:20:32.601Z",
            "content_html": "<h1 id=\"第一章-继承\"><a class=\"anchor\" href=\"#第一章-继承\">#</a> 第一章 继承</h1>\n<h2 id=\"11-继承的概述\"><a class=\"anchor\" href=\"#11-继承的概述\">#</a> 1.1 继承的概述</h2>\n<p><strong>继承:</strong> 就是子类继承父类的属性和行为，使得子类对象具有与父类相同的属性、相同的行为。</p>\n<h3 id=\"111继承的好处\"><a class=\"anchor\" href=\"#111继承的好处\">#</a> 1.1.1 继承的好处</h3>\n<p>提高代码的复用性。<br />\n提高代码的扩展性。<br />\n类与类之间产生了关系，是学习多态的前提。</p>\n<h2 id=\"12继承的格式\"><a class=\"anchor\" href=\"#12继承的格式\">#</a> 1.2 继承的格式</h2>\n<p>通过 extends 关键字，可以声明一个子类继承另外一个父类，定义格式如下：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> 父类类名 <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> 子类类名 <span class=\"token keyword\">extends</span> 父类类名 <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>继承演示:</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 定义动物类 Animal，做为父类</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Animal</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// 定义 name 属性</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 定义 age 属性</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 定义动物的吃东西方法</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>age <span class=\"token operator\">+</span> <span class=\"token string\">\"岁的\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token string\">\"在吃东西\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * 定义猫类 Cat 继承 动物类 Animal</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Cat</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Animal</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 定义一个猫抓老鼠的方法 catchMouse</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">catchMouse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"抓老鼠\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"25\"></td><td><pre> * 定义测试类</pre></td></tr><tr><td data-num=\"26\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ExtendDemo01</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// 创建一个猫类对象 </span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token class-name\">Cat</span> cat <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Cat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token comment\">// 为该猫类对象的 name 属性进行赋值</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        cat<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"Tom\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token comment\">// 为该猫类对象的 age 属性进行赋值 </span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        cat<span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token comment\">// 调用该猫的 catchMouse () 方法 </span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        cat<span class=\"token punctuation\">.</span><span class=\"token function\">catchMouse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token comment\">// 调用该猫继承来的 eat () 方法 </span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        cat<span class=\"token punctuation\">.</span><span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>演示结果：<br />\n抓老鼠<br />\n 2 岁的 Tom 在吃东西</p>\n</blockquote>\n<h2 id=\"13-继承的特点一成员变量\"><a class=\"anchor\" href=\"#13-继承的特点一成员变量\">#</a> 1.3 继承的特点一：成员变量</h2>\n<h3 id=\"131私有化private\"><a class=\"anchor\" href=\"#131私有化private\">#</a> 1.3.1 私有化（private）</h3>\n<p>父类中的成员，无论是公有 (public) 还是私有 (private)，均会被子类继承。<br />\n子类虽会继承父类私有 (private) 的成员，但子类不能对继承的私有成员直接进行访问，可通过继承<br />\n的公有方法进行访问。如图所示：</p>\n<p><img data-src=\"https://miyazono-1255488789.cos.ap-shanghai.myqcloud.com/markdown/20210415104325.png\" alt=\"image\" /></p>\n<pre><code>   官方结论:\n       (1)子类可以继承父类所有的属性和行为\n       (2)子类可以继承同包下父类的私有成员\n       (3)子类不可以继承父类的私有成员\n \n   自己总结:\n       子类可以继承父类的私有属性和行为,因为是私有的,子类无法直接方法,但可以通过set和get进行方法\n</code></pre>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/** 定义动物类 Animal，做为父类 */</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Animal</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// 定义 name 属性 </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// 定义 age 属性 </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 定义动物的吃东西方法 </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>age <span class=\"token operator\">+</span> <span class=\"token string\">\"岁的\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token string\">\"在吃东西\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/** 定义猫类 Cat 继承 动物类 Animal */</span> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Cat</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Animal</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// 定义一个猫抓老鼠的方法</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    catchMouse <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">catchMouse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"抓老鼠\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">/** 定义测试类 */</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ExtendDemo01</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">// 创建一个猫类对象 </span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">Cat</span> cat <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Cat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// 为该猫类对象的 name 属性进行赋值 </span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">//t.name = \"Tom\";// 编译报错 </span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// 为该猫类对象的 age 属性进行赋值 </span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        t<span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// 调用该猫的 catchMouse () 方法 </span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        t<span class=\"token punctuation\">.</span><span class=\"token function\">catchMouse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// 调用该猫继承来的 eat () 方法 </span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        t<span class=\"token punctuation\">.</span><span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"132成员变量重名问题\"><a class=\"anchor\" href=\"#132成员变量重名问题\">#</a> 1.3.2 成员变量重名问题</h3>\n",
            "tags": []
        },
        {
            "id": "https://github.com/Mayizono/miyazono.github.io/big-data/flume/Flume%E7%BB%83%E4%B9%A0%E9%A2%98/",
            "url": "https://github.com/Mayizono/miyazono.github.io/big-data/flume/Flume%E7%BB%83%E4%B9%A0%E9%A2%98/",
            "title": "Flume练习题",
            "date_published": "2020-08-09T16:00:00.000Z",
            "content_html": "<h1 id=\"flume练习题\"><a class=\"anchor\" href=\"#flume练习题\">#</a> Flume 练习题</h1>\n<hr />\n<h2 id=\"题目1\"><a class=\"anchor\" href=\"#题目1\">#</a> 题目 1</h2>\n<p>需求：使用 Flume 监听一个端口，收集该端口数据，并打印到控制台。</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> netcat</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>bind <span class=\"token operator\">=</span> localhost </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">44444</span>  </pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> logger</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><h2 id=\"题目2\"><a class=\"anchor\" href=\"#题目2\">#</a> 题目 2</h2>\n<p>实时监控 Hive 日志，并上传到 HDFS 中</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">exec</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>command <span class=\"token operator\">=</span> tail <span class=\"token operator\">-</span>F <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>hive<span class=\"token operator\">/</span>logs<span class=\"token operator\">/</span>hive<span class=\"token punctuation\">.</span>log </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>shell <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>bash <span class=\"token operator\">-</span>c</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> hdfs</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>path <span class=\"token operator\">=</span> hdfs:<span class=\"token comment\">//hadoop102:9820/flume/upload2/%Y%m%d/%H   </span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#上传文件的前缀</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>filePrefix <span class=\"token operator\">=</span> upload<span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#是否按照时间滚动文件夹</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>round <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#多少时间单位创建一个新的文件夹</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>roundValue <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#重新定义时间单位</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>roundUnit <span class=\"token operator\">=</span> <span class=\"token keyword\">hour</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#是否使用本地时间戳</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>useLocalTimeStamp <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#积攒多少个 Event 才 flush 到 HDFS 一次</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>batchSize <span class=\"token operator\">=</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">#设置文件类型，可支持压缩</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>fileType <span class=\"token operator\">=</span> DataStream</pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">#多久生成一个新的文件</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollInterval <span class=\"token operator\">=</span> <span class=\"token number\">60</span> </pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">#设置每个文件的滚动大小大概是 128M</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollSize <span class=\"token operator\">=</span> <span class=\"token number\">134217700</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\">#文件的滚动与 Event 数量无关</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><h2 id=\"题目3\"><a class=\"anchor\" href=\"#题目3\">#</a> 题目 3</h2>\n<p>使用 Flume 监听整个目录的文件，并上传至 HDFS</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># Describe/configure the source</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> spooldir </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>spoolDir <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>upload </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>fileSuffix <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span>COMPLETED </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>fileHeader <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#忽略所有以.tmp 结尾的文件，不上传</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>ignorePattern <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">^</span> <span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>\\<span class=\"token punctuation\">.</span>tmp<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> hdfs</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>path <span class=\"token operator\">=</span> hdfs:<span class=\"token comment\">//hadoop102:9820/flume/upload/%Y%m%d/%H   </span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#上传文件的前缀</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>filePrefix <span class=\"token operator\">=</span> upload<span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#是否按照时间滚动文件夹</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>round <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#多少时间单位创建一个新的文件夹</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>roundValue <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#重新定义时间单位</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>roundUnit <span class=\"token operator\">=</span> <span class=\"token keyword\">hour</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">#是否使用本地时间戳</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>useLocalTimeStamp <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">#积攒多少个 Event 才 flush 到 HDFS 一次</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>batchSize <span class=\"token operator\">=</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">#设置文件类型，可支持压缩</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>fileType <span class=\"token operator\">=</span> DataStream</pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\">#多久生成一个新的文件</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollInterval <span class=\"token operator\">=</span> <span class=\"token number\">60</span> </pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">#设置每个文件的滚动大小大概是 128M</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollSize <span class=\"token operator\">=</span> <span class=\"token number\">134217700</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">#文件的滚动与 Event 数量无关</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><h2 id=\"题目4\"><a class=\"anchor\" href=\"#题目4\">#</a> 题目 4</h2>\n<p>使用 Flume 监听整个目录的实时追加文件，并上传至 HDFS</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># Describe/configure the source</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> TAILDIR </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>positionFile <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>tail_dir<span class=\"token punctuation\">.</span>json <span class=\"token comment\">-- 指定 position_file 的位置 (记录每次上传后的偏移量，实现断点续传的关键)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>filegroups <span class=\"token operator\">=</span> f1 f2 <span class=\"token comment\">-- 监控的文件目录集合</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>filegroups<span class=\"token punctuation\">.</span>f1 <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>files<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span><span class=\"token keyword\">file</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token comment\">-- 定义监控的文件目录 1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>filegroups<span class=\"token punctuation\">.</span>f2 <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>files<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>log<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token comment\">-- 定义监控的文件目录 2</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> hdfs</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>path <span class=\"token operator\">=</span> hdfs:<span class=\"token comment\">//hadoop102:9820/flume/upload3/%Y%m%d/%H   </span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#上传文件的前缀</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>filePrefix <span class=\"token operator\">=</span> upload<span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#是否按照时间滚动文件夹</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>round <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#多少时间单位创建一个新的文件夹</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>roundValue <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#重新定义时间单位</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>roundUnit <span class=\"token operator\">=</span> <span class=\"token keyword\">hour</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">#是否使用本地时间戳</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>useLocalTimeStamp <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">#积攒多少个 Event 才 flush 到 HDFS 一次</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>batchSize <span class=\"token operator\">=</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">#设置文件类型，可支持压缩</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>fileType <span class=\"token operator\">=</span> DataStream</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#多久生成一个新的文件</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollInterval <span class=\"token operator\">=</span> <span class=\"token number\">60</span> </pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">#设置每个文件的滚动大小大概是 128M</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollSize <span class=\"token operator\">=</span> <span class=\"token number\">134217700</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">#文件的滚动与 Event 数量无关</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><h2 id=\"题目5\"><a class=\"anchor\" href=\"#题目5\">#</a> 题目 5</h2>\n<p>使用 Flume-1 监控文件变动，Flume-1 将变动内容传递给 Flume-2，Flume-2 负责存储到 HDFS。同时 Flume-1 将变动内容传递给 Flume-3，Flume-3 负责输出到 Local FileSystem。</p>\n<ul>\n<li>flume1：</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1 k2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1 c2</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># Describe/configure the source</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> TAILDIR </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>positionFile <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>tail_dir<span class=\"token punctuation\">.</span>json </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>filegroups <span class=\"token operator\">=</span> f1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>filegroups<span class=\"token punctuation\">.</span>f1 <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>files<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>log<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c2<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c2<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c2<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">=</span> hadoop103 </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">6666</span>  </pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">=</span> hadoop104 </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">8888</span>  </pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1 c2</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c2</pre></td></tr></table></figure><ul>\n<li>flume2:</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># Describe/configure the source</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>bind <span class=\"token operator\">=</span> hadoop103 </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">6666</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> hdfs</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>path <span class=\"token operator\">=</span> hdfs:<span class=\"token comment\">//hadoop102:9820/flume/upload4/%Y%m%d/%H   </span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#上传文件的前缀</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>filePrefix <span class=\"token operator\">=</span> upload<span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#是否按照时间滚动文件夹</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>round <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#多少时间单位创建一个新的文件夹</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>roundValue <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#重新定义时间单位</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>roundUnit <span class=\"token operator\">=</span> <span class=\"token keyword\">hour</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#是否使用本地时间戳</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>useLocalTimeStamp <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">#积攒多少个 Event 才 flush 到 HDFS 一次</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>batchSize <span class=\"token operator\">=</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">#设置文件类型，可支持压缩</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>fileType <span class=\"token operator\">=</span> DataStream</pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">#多久生成一个新的文件</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollInterval <span class=\"token operator\">=</span> <span class=\"token number\">60</span>  </pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\">#设置每个文件的滚动大小大概是 128M</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollSize <span class=\"token operator\">=</span> <span class=\"token number\">134217700</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">#文件的滚动与 Event 数量无关</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><ul>\n<li>flum3:</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># Describe/configure the source</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>bind <span class=\"token operator\">=</span> hadoop104 </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">8888</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> file_roll</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>sink<span class=\"token punctuation\">.</span>directory <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>datas<span class=\"token operator\">/</span>flume3</pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><h2 id=\"题目6\"><a class=\"anchor\" href=\"#题目6\">#</a> 题目 6</h2>\n<p>使用 Flume1 监控一个端口，其 sink 组中的 sink 分别对接 Flume2 和 Flume3，采用 FailoverSinkProcessor，实现故障转移的功能</p>\n<ul>\n<li>flume1</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups <span class=\"token operator\">=</span> g1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1 k2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># Describe/configure the source</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> netcat</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>bind <span class=\"token operator\">=</span> localhost </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">44444</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> failover </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span>priority<span class=\"token punctuation\">.</span>k1 <span class=\"token operator\">=</span> <span class=\"token number\">10</span> </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span>priority<span class=\"token punctuation\">.</span>k2 <span class=\"token operator\">=</span> <span class=\"token number\">5</span> </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span>maxpenalty <span class=\"token operator\">=</span> <span class=\"token number\">10000</span> </pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">=</span> hadoop103</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">1111</span>  </pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">=</span> hadoop104</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">2222</span>  </pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1 k2</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><ul>\n<li>flume2</li>\n</ul>\n<pre><code class=\"language-Sql\">#步骤一：agent Name\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n#步骤二：source\n# Describe/configure the source\na1.sources.r1.type = avro\na1.sources.r1.bind = hadoop103\na1.sources.r1.port = 1111 \n\n#步骤三： channel selector\na1.sources.r1.selector.type = replicating\n\n#步骤四： channel\n# Describe the channel\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000 \na1.channels.c1.transactionCapacity = 100 \n\n#步骤五： sinkprocessor，默认配置defaultsinkprocessor\n\n#步骤六： sink\n# Describe the sink\na1.sinks.k1.type = logger \n\n#步骤七：连接source、channel、sink\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n</code></pre>\n<ul>\n<li>flume3</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># Describe/configure the source</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>bind <span class=\"token operator\">=</span> hadoop104</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">2222</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> logger </pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><h2 id=\"题目7\"><a class=\"anchor\" href=\"#题目7\">#</a> 题目 7</h2>\n<p>hadoop102 上的 Flume-1 监控文件 /opt/module/group.log，</p>\n<p>hadoop103 上的 Flume-2 监控某一个端口的数据流，</p>\n<p>Flume-1 与 Flume-2 将数据发送给 hadoop104 上的 Flume-3，Flume-3 将最终数据打印到控制台。</p>\n<ul>\n<li>flume1</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> TAILDIR </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>positionFile <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>tail_dir<span class=\"token punctuation\">.</span>json </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>filegroups <span class=\"token operator\">=</span> f1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>filegroups<span class=\"token punctuation\">.</span>f1 <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>files<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>log<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">=</span> hadoop104</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">4141</span>  </pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><ul>\n<li>flume2</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> netcat</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>bind <span class=\"token operator\">=</span> localhost </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">3333</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">=</span> hadoop104</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">4141</span>  </pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><ul>\n<li>flume3</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>bind <span class=\"token operator\">=</span> hadoop104</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">4141</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> logger </pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><h2 id=\"题目8\"><a class=\"anchor\" href=\"#题目8\">#</a> 题目 8</h2>\n<p>需求：</p>\n<ol>\n<li>\n<p>a1 102 接收 TailDirSource 数据，监控 /var/log/*.log，复制输出到 a2 a3</p>\n</li>\n<li>\n<p>a2 103 接收 a1 数据，输出到 HDFS，failover 到本地 FileRoll</p>\n</li>\n<li>\n<p>a3 104 接收 a1 数据，输出到控制台</p>\n</li>\n</ol>\n<ul>\n<li>flume1</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1 k2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1 c2</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> TAILDIR </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>positionFile <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>tail_dir<span class=\"token punctuation\">.</span>json </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>filegroups <span class=\"token operator\">=</span> f1 </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>filegroups<span class=\"token punctuation\">.</span>f1 <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>files<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span><span class=\"token keyword\">file</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c2<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c2<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c2<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">=</span> hadoop103</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">6666</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">=</span> hadoop104 </pre></td></tr><tr><td data-num=\"38\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">8888</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1 c2</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c2</pre></td></tr></table></figure><ul>\n<li>flume2:</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups <span class=\"token operator\">=</span> g1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1 k2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>bind <span class=\"token operator\">=</span> hadoop103</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">6666</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> failover </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span>priority<span class=\"token punctuation\">.</span>k1 <span class=\"token operator\">=</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span>priority<span class=\"token punctuation\">.</span>k2 <span class=\"token operator\">=</span> <span class=\"token number\">5</span> </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span>maxpenalty <span class=\"token operator\">=</span> <span class=\"token number\">10000</span> </pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> hdfs</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>path <span class=\"token operator\">=</span> hdfs:<span class=\"token comment\">//hadoop102:9820/flume/upload2/%Y%m%d/%H  </span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#上传文件的前缀</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>filePrefix <span class=\"token operator\">=</span> upload<span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">#是否按照时间滚动文件夹</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>round <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">#多少时间单位创建一个新的文件夹</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>roundValue <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">#重新定义时间单位</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>roundUnit <span class=\"token operator\">=</span> <span class=\"token keyword\">hour</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\">#是否使用本地时间戳</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>useLocalTimeStamp <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">#积攒多少个 Event 才 flush 到 HDFS 一次</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>batchSize <span class=\"token operator\">=</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">#设置文件类型，可支持压缩</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>fileType <span class=\"token operator\">=</span> DataStream</pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\">#多久生成一个新的文件</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollInterval <span class=\"token operator\">=</span> <span class=\"token number\">60</span>  </pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">#设置每个文件的滚动大小大概是 128M</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollSize <span class=\"token operator\">=</span> <span class=\"token number\">134217700</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\">#文件的滚动与 Event 数量无关</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> logger</pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1 k2</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><ul>\n<li>flume3:</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#步骤一：agent Name</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#步骤二：source</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>bind <span class=\"token operator\">=</span> hadoop104</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">8888</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#步骤三： channel selector</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> replicating</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#步骤四： channel</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#步骤五： sinkprocessor，默认配置 defaultsinkprocessor</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#步骤六： sink</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> logger</pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#步骤七：连接 source、channel、sink</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure>",
            "tags": [
                "大数据",
                "Flume"
            ]
        },
        {
            "id": "https://github.com/Mayizono/miyazono.github.io/big-data/flume/Flume/",
            "url": "https://github.com/Mayizono/miyazono.github.io/big-data/flume/Flume/",
            "title": "Flume基础学习",
            "date_published": "2020-08-05T16:00:00.000Z",
            "content_html": "<h2 id=\"一-写flume的步骤\"><a class=\"anchor\" href=\"#一-写flume的步骤\">#</a> 一、写 flume 的步骤</h2>\n<h3 id=\"100-flume-事务\"><a class=\"anchor\" href=\"#100-flume-事务\">#</a> 1.0.0 Flume 事务</h3>\n<p><img data-src=\"https://miyazono-1255488789.cos.ap-shanghai.myqcloud.com/markdown/20210820202104.png\" alt=\"image-flume-事务\" /></p>\n<h3 id=\"101-flume-agent内部原理\"><a class=\"anchor\" href=\"#101-flume-agent内部原理\">#</a> 1.0.1 Flume Agent 内部原理</h3>\n<p>​\t\t\t\t\t\t\t\t\t\t\t\t<img data-src=\"https://miyazono-1255488789.cos.ap-shanghai.myqcloud.com/markdown/20210820202313.png\" alt=\"image-flume-agent\" />\t\t\t\t\t\t\t\t\t\t\t\t图 1</p>\n<h3 id=\"11-画拓扑图\"><a class=\"anchor\" href=\"#11-画拓扑图\">#</a> 1.1 画拓扑图</h3>\n<blockquote>\n<p>总结：一个 channel 只能输出一个结果文件。</p>\n<p>一个 flume agent 由 source + channel + sink 构成，类比于 mapper + shuffer + reducer。</p>\n</blockquote>\n<h4 id=\"111-确定source类型\"><a class=\"anchor\" href=\"#111-确定source类型\">#</a> 1.1.1 确定 source 类型</h4>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>常用类型：</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> arvo:  用于Flume agent 之间的数据源传递</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> netcat: 用于监听端口</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token number\">3</span>）<span class=\"token keyword\">exec</span>: 用于执行linux中的操作指令</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> spooldir: 用于监视文件或目录</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> taildir: 用于监视文件或目录，同时支持追加的监听</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t总结 ，<span class=\"token number\">3</span><span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token operator\">/</span><span class=\"token number\">5</span>三种方式，最常用的是<span class=\"token number\">5</span>，适合用于监听多个实时追加的文件，并且能够实现断点续传。</pre></td></tr></table></figure><h4 id=\"112-确定channel-selector-的选择器\"><a class=\"anchor\" href=\"#112-确定channel-selector-的选择器\">#</a> 1.1.2 <strong>确定 channel selector 的选择器</strong></h4>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>）replicating channel selector：复制，每个channel发一份数据 <span class=\"token comment\">-- 默认的选择器</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> multiplexing channel selector : 根据配置配件，指定source源获取的数据发往一个或多个channel</pre></td></tr></table></figure><h4 id=\"113-确认channel类型参数\"><a class=\"anchor\" href=\"#113-确认channel类型参数\">#</a> <strong>1.1.3 确认 channel 类型参数</strong></h4>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>） Memory Channel ： 加载在内存中，存在数据丢失的风险 <span class=\"token comment\">-- 学习阶段使用此参数</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token number\">2</span>） <span class=\"token keyword\">File</span> Channel ：落入磁盘</pre></td></tr></table></figure><h4 id=\"114-确定sinkprocessor参数\"><a class=\"anchor\" href=\"#114-确定sinkprocessor参数\">#</a> <strong>1.1.4 确定 sinkprocessor 参数</strong></h4>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>） DefaultSinkProcessor：对应的是单个的Sink</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token number\">2</span>） LoadBalancingSinkProcessor ：对应的是多个的Sink，可以实现负载均衡的功能</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token number\">3</span>） FailoverSinkProcessor ：对应的是多个的Sink，容错功能，先指定一个sink，所有的数据都走指定的sink，当sink故障以后，其他的sink顶上，如果开始sink恢复了，那么数据继续走原有指定的sink。</pre></td></tr></table></figure><h4 id=\"115-确定sink的类型\"><a class=\"anchor\" href=\"#115-确定sink的类型\">#</a> <strong>1.1.5 确定 sink 的类型</strong></h4>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>常使用的类型有：</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> avro: 用于输出到下一个Flume Agent ，一个开源的序列化框架</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> hdfs: 输出到hdfs</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> fill_roll: 输出到本地</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> logger: 输出到控制台</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> hbase: 输出到hbase</pre></td></tr></table></figure><h4 id=\"116-拓扑例图\"><a class=\"anchor\" href=\"#116-拓扑例图\">#</a> 1.1.6 拓扑例图</h4>\n<p>​\t\t\t\t\t\t\t\t\t\t<img data-src=\"https://miyazono-1255488789.cos.ap-shanghai.myqcloud.com/markdown/20210820202453.png\" alt=\"图2\" /></p>\n<p>​\t\t\t\t\t\t\t\t\t\t<img data-src=\"https://miyazono-1255488789.cos.ap-shanghai.myqcloud.com/markdown/20210820202537.png\" alt=\"图3\" /></p>\n<p>​\t图 3</p>\n<h3 id=\"12-写配置文件\"><a class=\"anchor\" href=\"#12-写配置文件\">#</a> 1.2 写配置文件</h3>\n<h4 id=\"121-配置文件的构成\"><a class=\"anchor\" href=\"#121-配置文件的构成\">#</a> 1.2.1 配置文件的构成</h4>\n<ol>\n<li>Name the components on this agent  -- agent Name</li>\n<li>Describe/configure the source  -- source</li>\n<li>channel selector</li>\n<li>Describe the channel  -- channel</li>\n<li>sinkprocessor</li>\n<li>Describe the sink   --sink</li>\n<li>Bind the source and sink to the channel -- 连接 source、channel、sink</li>\n</ol>\n<h4 id=\"122-agent-name\"><a class=\"anchor\" href=\"#122-agent-name\">#</a> 1.2.2   agent Name</h4>\n<p>情况 1：source、channel、sink 各一个</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><p>情况 2：source 一个、channel 一个、sink 多个</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups <span class=\"token operator\">=</span> g1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1 k2</pre></td></tr></table></figure><p>情况 3：source 一个、channel 多个、sink 多个</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources <span class=\"token operator\">=</span> r1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1 k2</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1 c2</pre></td></tr></table></figure><h4 id=\"123-source\"><a class=\"anchor\" href=\"#123-source\">#</a> 1.2.3  source</h4>\n<p>情况 1：avro</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>bind <span class=\"token operator\">=</span> hadoop102 <span class=\"token comment\">-- hosename</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">4141</span> <span class=\"token comment\">-- 端口号</span></pre></td></tr></table></figure><p>情况 2：netcat</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> netcat</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>bind <span class=\"token operator\">=</span> localhost <span class=\"token comment\">-- 指接收来自 ip 为 localhost 发来的数据，如果是 0.0.0.0，则表示可以接收来自任意 ip 地址发来的数据</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">44444</span>  <span class=\"token comment\">-- 本机的端口号，从该端口接收数据</span></pre></td></tr></table></figure><p>情况 3：exec</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">exec</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>command <span class=\"token operator\">=</span> tail <span class=\"token operator\">-</span>F <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>hive<span class=\"token operator\">/</span>logs<span class=\"token operator\">/</span>hive<span class=\"token punctuation\">.</span>log <span class=\"token comment\">-->linux 执行的命令</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>shell <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>bash <span class=\"token operator\">-</span>c <span class=\"token comment\">-- linux 的解析器</span></pre></td></tr></table></figure><p>情况 4: sqooldir</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Describe/configure the source</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> spooldir <span class=\"token comment\">-- 定义 source 类型</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>spoolDir <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>upload <span class=\"token comment\">-- 定义监控的文件或目录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>fileSuffix <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span>COMPLETED <span class=\"token comment\">-- 定义文件上传后的后缀</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>fileHeader <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span> <span class=\"token comment\">-- 是否有文件头</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#忽略所有以.tmp 结尾的文件，不上传</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>ignorePattern <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">^</span> <span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>\\<span class=\"token punctuation\">.</span>tmp<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>情况 5：talidir</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Describe/configure the source</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> TAILDIR </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>positionFile <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>tail_dir<span class=\"token punctuation\">.</span>json <span class=\"token comment\">-- 指定 position_file 的位置，(记录每次上传后的偏移量，实现断点续传的关键)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>batchSize<span class=\"token operator\">=</span><span class=\"token number\">500</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>filegroups <span class=\"token operator\">=</span> f1 f2 <span class=\"token comment\">-- 监控的文件目录集合</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>filegroups<span class=\"token punctuation\">.</span>f1 <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>files<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span><span class=\"token keyword\">file</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token comment\">-- 定义监控的文件目录 1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>filegroups<span class=\"token punctuation\">.</span>f2 <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>files<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>log<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token comment\">-- 定义监控的文件目录 2</span></pre></td></tr></table></figure><h4 id=\"124-channel-selector\"><a class=\"anchor\" href=\"#124-channel-selector\">#</a> 1.2.4 channel selector</h4>\n<p>情况 1： replicating channel selector</p>\n<pre><code># 将数据流复制给所有channel\na1.sources.r1.selector.type = replicating\n</code></pre>\n<p>情况 2：multiplexing channel selector 需配合指定的拦截器使用（interceptor）</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- 指定拦截器</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>interceptors <span class=\"token operator\">=</span> i1 <span class=\"token comment\">-- 指定拦截器的名称</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>interceptors<span class=\"token punctuation\">.</span>i1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> com<span class=\"token punctuation\">.</span>atguigu<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span>interceptor<span class=\"token punctuation\">.</span>CustomInterceptor$Builder</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">-- 指定拦截器的类型 = 自定义拦截器中 builder 的实现类的全类名</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">-- 指定 channel 的选择器</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> multiplexing  <span class=\"token comment\">-- 定义 channel 的选择器类型</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span>header <span class=\"token operator\">=</span> <span class=\"token keyword\">type</span>  <span class=\"token comment\">-- 自定义拦截器的 header 的 k</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span>mapping<span class=\"token punctuation\">.</span>letter <span class=\"token operator\">=</span> c1 <span class=\"token comment\">-- letter 是 map 中一个 value 值，相同的 letter 进入一个 channel 中</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span>mapping<span class=\"token punctuation\">.</span>number <span class=\"token operator\">=</span> c2 <span class=\"token comment\">-- number 是 map 中一个 value 值，相同的 number 进入一个 channel 中</span></pre></td></tr></table></figure><h4 id=\"125-channel\"><a class=\"anchor\" href=\"#125-channel\">#</a> 1.2.5 channel</h4>\n<p>情况 1： memory</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Describe the channel</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> memory</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> <span class=\"token comment\">-- 表示 channel 总容量为 1000 个 event</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>transactionCapacity <span class=\"token operator\">=</span> <span class=\"token number\">100</span> <span class=\"token comment\">-- 表示 channel 传输时收集到的 100 条 event</span></pre></td></tr></table></figure><p>情况 2 ： flie</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span><span class=\"token operator\">=</span><span class=\"token keyword\">file</span>  <span class=\"token comment\">--channel 类型</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>checkpointDir<span class=\"token operator\">=</span><span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span><span class=\"token keyword\">checkpoint</span><span class=\"token operator\">/</span>behavior1 <span class=\"token comment\">--checkpoint 文件存储的地址</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>dataDirs<span class=\"token operator\">=</span><span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span><span class=\"token keyword\">data</span><span class=\"token operator\">/</span>behavior1<span class=\"token operator\">/</span>  <span class=\"token comment\">-- channel 中 event 文件在磁盘中存储的地址</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>capacity<span class=\"token operator\">=</span><span class=\"token number\">1000000</span> <span class=\"token comment\">--checkpoint 个数的最大容量</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>maxFileSize<span class=\"token operator\">=</span><span class=\"token number\">2146435071</span> <span class=\"token comment\">-- 一个 event 文件存储的最大的大小</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>keep<span class=\"token operator\">-</span>alive<span class=\"token operator\">=</span><span class=\"token number\">6</span> <span class=\"token comment\">-- 当 put 事务将数据提交到 channel 队列中，channel 队列没有足够的空间时，提交事务等待的最大时间</span></pre></td></tr></table></figure><h4 id=\"126-sinkprocessor\"><a class=\"anchor\" href=\"#126-sinkprocessor\">#</a> 1.2.6 sinkprocessor</h4>\n<p>情况 1：DefaultSinkProcessor -- 对应单个 Sink</p>\n<pre><code>不用写任何配置信息，默认值。\n</code></pre>\n<p>情况 2：FailoverSinkProcessor -- 对应的是 Sink Group</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> failover <span class=\"token comment\">-- 指定类型</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span>priority<span class=\"token punctuation\">.</span>k1 <span class=\"token operator\">=</span> <span class=\"token number\">5</span> <span class=\"token comment\">-- 设置 K1 的 sink 的优先级</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span>priority<span class=\"token punctuation\">.</span>k2 <span class=\"token operator\">=</span> <span class=\"token number\">10</span> <span class=\"token comment\">-- 设置 K2 的 sink 的优先级</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span>maxpenalty <span class=\"token operator\">=</span> <span class=\"token number\">10000</span> <span class=\"token comment\">-- 设置故障的转换时间 10s。默认值为 30s</span></pre></td></tr></table></figure><p>情况 3：LoadBalancingSinkProcessor -- 对应的是 Sink Group</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span>load_balance <span class=\"token comment\">-- 指定类型</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span>backoff <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span> <span class=\"token comment\">-- 暂不讨论</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>processor<span class=\"token punctuation\">.</span>selector <span class=\"token operator\">=</span>round_robin <span class=\"token comment\">-- 暂不讨论</span></pre></td></tr></table></figure><h4 id=\"127-sink\"><a class=\"anchor\" href=\"#127-sink\">#</a> 1.2.7 sink</h4>\n<p>情况 1：avro</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> avro</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">=</span> hadoop104 <span class=\"token comment\">-- hosaname</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> <span class=\"token number\">4141</span>  <span class=\"token comment\">-- 端口</span></pre></td></tr></table></figure><p>情况 2：hdfs</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> hdfs</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>path <span class=\"token operator\">=</span> hdfs:<span class=\"token comment\">//hadoop102:9820/flume/upload2/% Y% m% d/% H   -- 上传到 HDFS 的路径</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#上传文件的前缀</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>filePrefix <span class=\"token operator\">=</span> upload<span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#是否按照时间滚动文件夹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>round <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#多少时间单位创建一个新的文件夹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>roundValue <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#重新定义时间单位</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>roundUnit <span class=\"token operator\">=</span> <span class=\"token keyword\">hour</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#是否使用本地时间戳</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>useLocalTimeStamp <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#积攒多少个 Event 才 flush 到 HDFS 一次</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>batchSize <span class=\"token operator\">=</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#设置文件类型，可支持压缩</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>fileType <span class=\"token operator\">=</span> DataStream</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#多久生成一个新的文件</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollInterval <span class=\"token operator\">=</span> <span class=\"token number\">60</span>  <span class=\"token comment\">-- 单位是秒</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#设置每个文件的滚动大小大概是 128M</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollSize <span class=\"token operator\">=</span> <span class=\"token number\">134217700</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#文件的滚动与 Event 数量无关</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>hdfs<span class=\"token punctuation\">.</span>rollCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr></table></figure><p>情况 3：fill_roll</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> file_roll</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>sink<span class=\"token punctuation\">.</span>directory <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>module<span class=\"token operator\">/</span>flume<span class=\"token operator\">/</span>datas<span class=\"token operator\">/</span>flume3 <span class=\"token comment\">-- 指定上传到本地的路径</span></pre></td></tr></table></figure><p>情况 4：logger</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Describe the sink</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> logger</pre></td></tr></table></figure><p>情况 5：hbase       --- 暂时不讨论</p>\n<h4 id=\"128-连接source-channel-sink\"><a class=\"anchor\" href=\"#128-连接source-channel-sink\">#</a> 1.2.8 连接 source、channel、sink</h4>\n<p>情况 1：source、channel、sink 各一个、</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><p>情况 2：source 一个、channel 一个、sink 多个</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Bind the source and sink to the channel</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinkgroups<span class=\"token punctuation\">.</span>g1<span class=\"token punctuation\">.</span>sinks <span class=\"token operator\">=</span> k1 k2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr></table></figure><p>情况 3：source 一个、channel 多个、sink 多个</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Bind the source and sink to the channel</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>channels <span class=\"token operator\">=</span> c1 c2</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k2<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> c2 <span class=\"token comment\">-- 特别注意 channel 没有 “s”</span></pre></td></tr></table></figure><h4 id=\"129-端口和ip的区别\"><a class=\"anchor\" href=\"#129-端口和ip的区别\">#</a> 1.2.9 端口和 ip 的区别</h4>\n<ul>\n<li>sink 端：向指定 ip 地址的端口发送数据</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>端口：</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ip（hostname）：</pre></td></tr></table></figure><ul>\n<li>source 端：监视指定端口并接收指定 ip 发送来的数据</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>端口：该端口只能是自己机器的端口</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ip（hostname）：指能够接受来自此ip的数据</pre></td></tr></table></figure><h3 id=\"13-连接flume\"><a class=\"anchor\" href=\"#13-连接flume\">#</a> 1.3 连接 flume</h3>\n<h4 id=\"131-查看指定ip的通信端口\"><a class=\"anchor\" href=\"#131-查看指定ip的通信端口\">#</a> 1.3.1 查看指定 ip 的通信端口</h4>\n<pre><code>sudo netstat -ntlp | grep 端口号\n</code></pre>\n<h4 id=\"132-关闭端口\"><a class=\"anchor\" href=\"#132-关闭端口\">#</a> 1.3.2 关闭端口</h4>\n<pre><code>sudo kill 端口的进程号\n</code></pre>\n<h4 id=\"133-连接指定ip地址的指定端口\"><a class=\"anchor\" href=\"#133-连接指定ip地址的指定端口\">#</a> 1.3.3 连接指定 ip 地址的指定端口</h4>\n<pre><code>nc ip 端口号\n</code></pre>\n<h4 id=\"134-启动flume\"><a class=\"anchor\" href=\"#134-启动flume\">#</a> 1.3.4  启动 flume</h4>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>bin<span class=\"token operator\">/</span>flume<span class=\"token operator\">-</span>ng agent <span class=\"token operator\">-</span>n <span class=\"token punctuation\">[</span>agent name<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span>c conf <span class=\"token operator\">-</span>f <span class=\"token punctuation\">[</span>自定义flume配置文件<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span>Dflume<span class=\"token punctuation\">.</span>root<span class=\"token punctuation\">.</span>logger<span class=\"token operator\">=</span>INFO<span class=\"token punctuation\">,</span>console</pre></td></tr></table></figure><h2 id=\"二-自定义interceptorsource-sink\"><a class=\"anchor\" href=\"#二-自定义interceptorsource-sink\">#</a> 二、自定义 interceptor，source、 sink</h2>\n<h3 id=\"21-自定义intercepor\"><a class=\"anchor\" href=\"#21-自定义intercepor\">#</a> 2.1 自定义 intercepor</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">flume_interceptor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Context</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Event</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span>interceptor<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Interceptor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Map</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @author lianzhipeng</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @Description</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @create 2020-05-05 10:45</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Interceptor</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>     * Description: 初始化方法，新建 Interceptor 时使用</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     * @Author: lianzhipeng</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     * @Date: 2020/5/5 10:45</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     * @return: void</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>     * Description: 更改方法，对 event 进行处理</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>     * @param event 传入的数据</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>     * @Author: lianzhipeng</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>     * @Date: 2020/5/5 10:47</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>     * @return: org.apache.flume.Event 返回处理好的数据</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Event</span> <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Event</span> event<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">// 获取 event 的 header</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> headers <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getHeaders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token comment\">// 获取 event 的 body</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> body <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token comment\">// 处理数据</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token class-name\">String</span> string <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">char</span> c <span class=\"token operator\">=</span> string<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">>=</span> <span class=\"token string\">'a'</span> <span class=\"token operator\">&amp;&amp;</span> c <span class=\"token operator\">&lt;=</span> <span class=\"token string\">'z'</span> <span class=\"token operator\">||</span> c <span class=\"token operator\">>=</span> <span class=\"token string\">'A'</span> <span class=\"token operator\">&amp;&amp;</span> c <span class=\"token operator\">&lt;=</span> <span class=\"token string\">'Z'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            headers<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"char\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            headers<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"not-char\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token comment\">// 返回数据</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token keyword\">return</span> event<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Event</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Event</span><span class=\"token punctuation\">></span></span> list<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Event</span> event <span class=\"token operator\">:</span> list<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>            <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">return</span> list<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>     * 框架会调用 MyBulider 来创建自定义拦截器实例</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyBulider</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Builder</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>        <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>         * Description: 创建自定义拦截器实例的方法</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>         *</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>         * @Author: lianzhipeng</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>         * @Date: 2020/5/5 10:54</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>         * @return: org.apache.flume.interceptor.Interceptor</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>         */</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token class-name\">Interceptor</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>        <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"95\"></td><td><pre>         * Description: 读取配置信息</pre></td></tr><tr><td data-num=\"96\"></td><td><pre>         *</pre></td></tr><tr><td data-num=\"97\"></td><td><pre>         * @param context</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>         * @Author: lianzhipeng</pre></td></tr><tr><td data-num=\"99\"></td><td><pre>         * @Date: 2020/5/5 10:54</pre></td></tr><tr><td data-num=\"100\"></td><td><pre>         * @return: void</pre></td></tr><tr><td data-num=\"101\"></td><td><pre>         */</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Context</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"22-自定义source\"><a class=\"anchor\" href=\"#22-自定义source\">#</a> 2.2 自定义 source</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">flume_interceptor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Context</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Event</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">EventDeliveryException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PollableSource</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ChannelProcessor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configurable</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span>event<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SimpleEvent</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AbstractSource</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @author lianzhipeng</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @Description</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @create 2020-05-05 14:31</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MySource</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractSource</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Configurable</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">PollableSource</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> prefix<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> interval<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     * Description: 拉取事件并交给 ChannelProcessor 处理的方法</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>     * @Author: lianzhipeng</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>     * @Date: 2020/5/5 14:33</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>     * @return: org.apache.flume.PollableSource.Status</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Status</span> <span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">EventDeliveryException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">Status</span> status <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token comment\">// 通过外部方法拉取数据</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token class-name\">Event</span> e <span class=\"token operator\">=</span> <span class=\"token function\">getSomeData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token comment\">// Store the Event into this Source's associated Channel(s)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token class-name\">ChannelProcessor</span> channelProcessor <span class=\"token operator\">=</span> <span class=\"token function\">getChannelProcessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            channelProcessor<span class=\"token punctuation\">.</span><span class=\"token function\">processEvent</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            status <span class=\"token operator\">=</span> <span class=\"token class-name\">Status</span><span class=\"token punctuation\">.</span>READY<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> t<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token comment\">// Log exception, handle individual exceptions as needed</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            status <span class=\"token operator\">=</span> <span class=\"token class-name\">Status</span><span class=\"token punctuation\">.</span>BACKOFF<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token comment\">// re-throw all Errors</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Error</span><span class=\"token punctuation\">)</span>t<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token keyword\">return</span> status<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>     * Description: 拉取数据并包装成 event 的过程</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>     * @Author: lianzhipeng</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>     * @Date: 2020/5/5 14:55</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>     * @return: org.apache.flume.Event 拉取到的数据</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Event</span> <span class=\"token function\">getSomeData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token comment\">// 添加前缀</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> prefix <span class=\"token operator\">+</span> i <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>interval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        <span class=\"token class-name\">SimpleEvent</span> event <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        event<span class=\"token punctuation\">.</span><span class=\"token function\">setBody</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        <span class=\"token keyword\">return</span>  event<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>     * Description: 如果拉取不到数据，backoff 时间的增长速度</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>     * @Author: lianzhipeng</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>     * @Date: 2020/5/5 14:34</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>     * @return: long 增长量</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">long</span> <span class=\"token function\">getBackOffSleepIncrement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"91\"></td><td><pre>     * Description: 最大的等待时间</pre></td></tr><tr><td data-num=\"92\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"93\"></td><td><pre>     * @Author: lianzhipeng</pre></td></tr><tr><td data-num=\"94\"></td><td><pre>     * @Date: 2020/5/5 14:38</pre></td></tr><tr><td data-num=\"95\"></td><td><pre>     * @return: long</pre></td></tr><tr><td data-num=\"96\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">long</span> <span class=\"token function\">getMaxBackOffSleepInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"102\"></td><td><pre>     * Description: 配置参数，来自于 configurable，可以定义我们自己定义的 source</pre></td></tr><tr><td data-num=\"103\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"104\"></td><td><pre>     * @param context 配置文件</pre></td></tr><tr><td data-num=\"105\"></td><td><pre>     * @Author: lianzhipeng</pre></td></tr><tr><td data-num=\"106\"></td><td><pre>     * @Date: 2020/5/5 14:39</pre></td></tr><tr><td data-num=\"107\"></td><td><pre>     * @return: void</pre></td></tr><tr><td data-num=\"108\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Context</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>        prefix <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"prefff\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"xxxx\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>        interval <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">getLong</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"interval\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">500L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"23-自定义sink\"><a class=\"anchor\" href=\"#23-自定义sink\">#</a> 2.3 自定义 sink</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">flume_interceptor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configurable</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span>sink<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AbstractSink</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @author lianzhipeng</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @Description</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @create 2020-05-05 14:31</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MySiink</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractSink</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Configurable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>     * Description: 改方法调用时，会从 Channel 中拉取数据并处理</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>     * @Author: lianzhipeng</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>     * @Date: 2020/5/5 15:09</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     * @return: org.apache.flume.Sink.Status 处理的状态</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Status</span> <span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">EventDeliveryException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">Status</span> status <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// Start transaction</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// 获取 channel</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">Channel</span> ch <span class=\"token operator\">=</span> <span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// 拉取数据的事务</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token class-name\">Transaction</span> txn <span class=\"token operator\">=</span> ch<span class=\"token punctuation\">.</span><span class=\"token function\">getTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token comment\">// 开始拉取</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        txn<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token comment\">// This try clause includes whatever Channel operations you want to do</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token comment\">// 拉取的数据，如果拉取不到，则返回 null</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token class-name\">Event</span> event<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">// 如果拉取的数据为 null，则等 0.1 秒后继续拉取数据，知道拉取数据</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>event <span class=\"token operator\">=</span> ch<span class=\"token punctuation\">.</span><span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token comment\">// Send the Event to the external repository.</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token comment\">// 如果拉取到了数据，将数据进行处理</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token function\">storeSomeData</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            txn<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            status <span class=\"token operator\">=</span> <span class=\"token class-name\">Status</span><span class=\"token punctuation\">.</span>READY<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> t<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            txn<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token comment\">// Log exception, handle individual exceptions as needed</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            status <span class=\"token operator\">=</span> <span class=\"token class-name\">Status</span><span class=\"token punctuation\">.</span>BACKOFF<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token comment\">// re-throw all Errors</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Error</span><span class=\"token punctuation\">)</span> t<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token comment\">// 拉取事务的关闭</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            txn<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token keyword\">return</span> status<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">storeSomeData</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Event</span> event<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token comment\">// 获取 event 的 body 数据</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> body <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token comment\">// 将数据写出到控制台</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre></pre></td></tr><tr><td data-num=\"76\"></td><td><pre></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Context</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"三-kafka与flume的结合\"><a class=\"anchor\" href=\"#三-kafka与flume的结合\">#</a> 三、kafka 与 flume 的结合</h2>\n<p>kafka：数据的中转站，主要功能由 topic 体现；</p>\n<p>flume：数据的采集，通过 source 和 sink 体现。</p>\n<h3 id=\"31-kafka-source\"><a class=\"anchor\" href=\"#31-kafka-source\">#</a> 3.1 kafka source</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- 问题 ：</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>fulme在kafka中的作用</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">-- 答案：</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>消费者</pre></td></tr></table></figure><p>配置文件：</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>KafkaSource <span class=\"token comment\">--source 类型</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>bootstrap<span class=\"token punctuation\">.</span>servers <span class=\"token operator\">=</span> hadoop105:<span class=\"token number\">9092</span><span class=\"token punctuation\">,</span>hadoop106:<span class=\"token number\">9092</span> <span class=\"token comment\">-- kafka 的集群</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>topics<span class=\"token operator\">=</span>topic_log <span class=\"token comment\">-- 订阅的话题</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>batchSize<span class=\"token operator\">=</span><span class=\"token number\">6000</span> <span class=\"token comment\">--putlist 中数据达到了 6K 以后提交到 channel 中</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sources<span class=\"token punctuation\">.</span>r1<span class=\"token punctuation\">.</span>batchDurationMillis<span class=\"token operator\">=</span><span class=\"token number\">2000</span> <span class=\"token comment\">-- 拉取数据的时间达到 2s 以后，将获取的数据提交到 channel 中</span></pre></td></tr></table></figure><h3 id=\"32-kakfa-channel\"><a class=\"anchor\" href=\"#32-kakfa-channel\">#</a> 3.2 kakfa channel</h3>\n<ul>\n<li>kakfa channel 这种情况使用的最多，此时的 flume 可以是消费者、生产者、source 和 sink 之间的缓冲区（具有高吞吐量的优势），Channel 是位于 Source 和 Sink 之间的缓冲区。</li>\n<li>一共有三种情况，分别是:</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">-- 情况一： 有 Flume source and sink -- 缓冲区</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kakfa channel为事件提供了可靠且高可用的通道；</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">-- 情况二： 有 source and interceptor but no sink -- 生产者</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>it allows writing Flume events <span class=\"token keyword\">into</span> a Kafka topic<span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span> <span class=\"token keyword\">use</span> <span class=\"token keyword\">by</span> other app</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">-- 情况三： 有 sink, but no source -- 消费者</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>it <span class=\"token operator\">is</span> a low<span class=\"token operator\">-</span>latency<span class=\"token punctuation\">,</span> fault tolerant way <span class=\"token keyword\">to</span> send events <span class=\"token keyword\">from</span> Kafka <span class=\"token keyword\">to</span> Flume sinks such <span class=\"token keyword\">as</span> HDFS<span class=\"token punctuation\">,</span> HBase <span class=\"token operator\">or</span> Solr</pre></td></tr></table></figure><p>配置文件：</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>KafkaChannel <span class=\"token comment\">----channel 类型</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>bootstrap<span class=\"token punctuation\">.</span>servers <span class=\"token operator\">=</span> hadoop105:<span class=\"token number\">9092</span><span class=\"token punctuation\">,</span>hadoop106:<span class=\"token number\">9092</span><span class=\"token punctuation\">,</span>hadoop107:<span class=\"token number\">9092</span> <span class=\"token comment\">--kafka 集群</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>topic <span class=\"token operator\">=</span>topic_log <span class=\"token comment\">-- 话题</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>parseAsFlumeEvent<span class=\"token operator\">=</span><span class=\"token boolean\">false</span> <span class=\"token comment\">-- 不需要 event 的 header 数据</span></pre></td></tr></table></figure><h3 id=\"33-kafka-sink\"><a class=\"anchor\" href=\"#33-kafka-sink\">#</a> 3.3 kafka sink</h3>\n<p>作用：将数据拉取到 kafka 的 topic 中。</p>\n<p>配置文件：</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flume<span class=\"token punctuation\">.</span>sink<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>KafkaSink <span class=\"token comment\">--sink 类型</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>topic <span class=\"token operator\">=</span>topic_log <span class=\"token comment\">-- 话题</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>bootstrap<span class=\"token punctuation\">.</span>servers <span class=\"token operator\">=</span> hadoop105:<span class=\"token number\">9092</span><span class=\"token punctuation\">,</span>hadoop106:<span class=\"token number\">9092</span><span class=\"token punctuation\">,</span>hadoop107:<span class=\"token number\">9092</span> <span class=\"token comment\">--kafka 集群</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>flumeBatchSize <span class=\"token operator\">=</span> <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span>acks <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token comment\">-- 副本策略</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span>linger<span class=\"token punctuation\">.</span>ms <span class=\"token operator\">=</span> <span class=\"token number\">1</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a1<span class=\"token punctuation\">.</span>sinks<span class=\"token punctuation\">.</span>k1<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span>compression<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> snappy  <span class=\"token comment\">-- 压缩格式</span></pre></td></tr></table></figure>",
            "tags": [
                "大数据",
                "Flume"
            ]
        }
    ]
}